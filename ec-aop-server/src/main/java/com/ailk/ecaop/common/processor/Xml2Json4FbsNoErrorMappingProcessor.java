package com.ailk.ecaop.common.processor;

import java.util.HashMap;
import java.util.Map;

import org.dom4j.Document;
import org.dom4j.DocumentHelper;
import org.dom4j.Element;
import org.n3r.config.Config;
import org.n3r.core.tag.EcRocTag;
import org.n3r.core.util.ParamsAppliable;
import org.n3r.ecaop.core.DefaultExchange;
import org.n3r.ecaop.core.Exchange;
import org.n3r.ecaop.core.Message;
import org.n3r.ecaop.core.exception.biz.EcAopServerBizException;
import org.n3r.ecaop.core.exception.sys.EcAopServerSysException;
import org.n3r.ecaop.core.impl.DefaultMessage;
import org.n3r.ecaop.core.processor.BaseAopProcessor;
import org.n3r.ecaop.eface.engine.EfaceEngine;
import org.n3r.ecaop.eface.engine.XmlBaseEngine;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.ailk.ecaop.common.utils.DealInterfaceUtils;
import com.ailk.ecaop.common.utils.SoapUtils;

@EcRocTag("Xml2JsonMapper4FbsNoError")
public class Xml2Json4FbsNoErrorMappingProcessor extends BaseAopProcessor implements ParamsAppliable {

    private String xmlTemplatePath;
    private String xmlBodyContent;
    private Logger log = LoggerFactory.getLogger(Xml2Json4FbsNoErrorMappingProcessor.class);

    @Override
    public void process(Exchange exchange) throws Exception {

        Throwable ex = exchange.getException();
        if (ex != null) {
            ex.printStackTrace();
            throw new EcAopServerBizException("9999", "调用接口异常:" + ex.getMessage());
        }

        String body = exchange.getOut().getBody().toString();
        // 把soap协议的xml格式去掉namespace，并且获取到包含UNI_BSS_HEAD UNI_BSS_BODY的报文
        body = SoapUtils.soapToXml(body);
        // EcAopReqLog reqLog = exchange.getProperty(Exchange.REQLOG, EcAopReqLog.class);
        // log.info("Fbs 报文返回处理后 -- reqTs: " + reqLog.getReqTs() + ", appTx: " + reqLog.getApptx() + ", 报文: " + body);
        Document doc = DocumentHelper.parseText(body);
        Element root = doc.getRootElement();

        // 分别获取头和体，获取头主要来判断是否成功
        Element uniBssHead = root.element("UNI_BSS_HEAD");
        Element uniBssBody = root.element("UNI_BSS_BODY");

        if (null == uniBssHead || null == uniBssBody) {
            int length = Math.min(200, body.length());
            throw new EcAopServerBizException("9999", "下游系统接口返回报文格式有误:" + body.substring(0, length));
        }

        // 定义操作名
        String operatorName = "";
        if (null != uniBssHead.element("OPERATE_NAME")) {
            operatorName = uniBssHead.element("OPERATE_NAME").getText();
        }
        String transIDO = uniBssHead.element("TRANS_IDO").getText();
        Element response = null;

        // 获取response节点
        response = uniBssHead.element("RESPONSE");
        if (null == response) {
            throw new EcAopServerSysException("9999", "下游系统报文异常，未返回应答;TRANSIDO为:" + transIDO);
        }
        log.debug("response:" + response);

        // 根据头信息是返回detail 和 code还是商城需要的信息
        Map tempMap = new HashMap();
        tempMap.put("operatorName", operatorName);
        tempMap.put("transIDO", transIDO);
        tempMap.put("methodCode", exchange.getMethodCode());
        Map dataMap = processAsHeadCode(uniBssBody, response, tempMap);
        exchange.getOut().setBody(dataMap);
    }

    private Map processAsHeadCode(Element uniBssBody, Element response, Map inMap) {
        String headCode = response.element("RSP_CODE").getText();
        Map dataMap = new HashMap();
        DealInterfaceUtils dif = new DealInterfaceUtils();
        if ("0000".equals(headCode) || "9999".equals(headCode)) {
            xmlBodyContent = uniBssBody.asXML();
            log.debug("xmlBodyContent:" + xmlBodyContent);
            try {
                XmlBaseEngine reader = new EfaceEngine().getReaderEngine();
                reader.parseTemplateFile(xmlTemplatePath);
                dataMap = (Map) reader.createMap(xmlBodyContent);
            }
            catch (Exception e) {
                throw new EcAopServerBizException("9999", dif.dealRespDesc4FBS(inMap, e.getMessage()));
            }
            String code = (String) dataMap.get("code");
            if (!"0000".equals(code)) {
                code = dif.dealOthercode(code, inMap.get("methodCode").toString());
            }
        }
        else {
            headCode = dif.dealTimeOutCode(headCode);
            String rspDesc = response.element("RSP_DESC").getText();
            throw new EcAopServerSysException(headCode, dif.dealRespDesc4FBS(inMap, rspDesc));
        }
        return dataMap;
    }

    public static void main(String[] args) throws Exception {
        Xml2Json4FbsNoErrorMappingProcessor xml = new Xml2Json4FbsNoErrorMappingProcessor();
        xml.applyParams(new String[] { "ecaop.cust.cbss.check.template" });
        Exchange exchange = new DefaultExchange();
        Message out = new DefaultMessage();
        out.setBody("<?xml version='1.0' encoding='UTF-8'?><SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"><SOAP-ENV:Body><m:QRY_CUST_INFO_OUTPUT xmlns:m=\"http://ws.chinaunicom.cn/CustSer/unibssBody\"><h:UNI_BSS_HEAD xmlns:h=\"http://ws.chinaunicom.cn/unibssHead\"><h:ORIG_DOMAIN>ECIP</h:ORIG_DOMAIN><h:SERVICE_NAME>CustSer</h:SERVICE_NAME><h:OPERATE_NAME>qryCustInfo</h:OPERATE_NAME><h:ACTION_CODE>1</h:ACTION_CODE><h:ACTION_RELATION>0</h:ACTION_RELATION><h:ROUTING><h:ROUTE_TYPE>00</h:ROUTE_TYPE><h:ROUTE_VALUE>36</h:ROUTE_VALUE></h:ROUTING><h:PROC_ID>3617122614313595</h:PROC_ID><h:TRANS_IDO>3617122614313595</h:TRANS_IDO><h:TRANS_IDH>20171226143135</h:TRANS_IDH><h:PROCESS_TIME>20171226143135</h:PROCESS_TIME><h:RESPONSE><h:RSP_TYPE>0</h:RSP_TYPE><h:RSP_CODE>0000</h:RSP_CODE><h:RSP_DESC>ok</h:RSP_DESC></h:RESPONSE><h:COM_BUS_INFO><h:OPER_ID>AEDKH135</h:OPER_ID><h:PROVINCE_CODE>36</h:PROVINCE_CODE><h:EPARCHY_CODE>360</h:EPARCHY_CODE><h:CITY_CODE>362001</h:CITY_CODE><h:CHANNEL_ID>36a0187</h:CHANNEL_ID><h:CHANNEL_TYPE>1010300</h:CHANNEL_TYPE><h:ACCESS_TYPE>09</h:ACCESS_TYPE><h:ORDER_TYPE>00</h:ORDER_TYPE></h:COM_BUS_INFO><h:SP_RESERVE><h:TRANS_IDC>3617122614313595</h:TRANS_IDC><h:CUTOFFDAY>20171226</h:CUTOFFDAY><h:OSNDUNS>0002</h:OSNDUNS><h:HSNDUNS>9900</h:HSNDUNS><h:CONV_ID>20171226143135</h:CONV_ID></h:SP_RESERVE><h:TEST_FLAG>0</h:TEST_FLAG><h:MSG_SENDER>9801</h:MSG_SENDER><h:MSG_RECEIVER>9800</h:MSG_RECEIVER></h:UNI_BSS_HEAD><m:UNI_BSS_BODY><m104:QRY_CUST_INFO_RSP xmlns:m104=\"http://ws.chinaunicom.cn/CustSer/unibssBody/qryCustInfoRsp\"><m104:RESP_CODE>0000</m104:RESP_CODE><m104:RESP_DESC>TradeOk</m104:RESP_DESC><m104:CUST_INFO><m104:CUST_ID>3617081411930229</m104:CUST_ID><m104:CUST_NAME>徐婷</m104:CUST_NAME><m104:CUST_TYPE>0</m104:CUST_TYPE><m104:CUST_STATE>0</m104:CUST_STATE><m104:CERT_END_DATE>20991231</m104:CERT_END_DATE><m104:CERT_ADDR>河北省唐山市丰南区黄各庄镇公庄子村4排15号</m104:CERT_ADDR><m104:CERT_TYPE_CODE>1</m104:CERT_TYPE_CODE><m104:CERT_CODE>130282199010151829</m104:CERT_CODE><m104:SEX>1</m104:SEX><m104:PHONE>18658188772</m104:PHONE><m104:EPARCHY_CODE>0571</m104:EPARCHY_CODE><m104:CITY_CODE>362001</m104:CITY_CODE><m104:CUST_PASSWD></m104:CUST_PASSWD><m104:DEVELOP_DEPART_ID>36a0187</m104:DEVELOP_DEPART_ID><m104:DEVELOP_STAFF_ID></m104:DEVELOP_STAFF_ID><m104:IN_DATE>20170814174356</m104:IN_DATE><m104:REMOVE_STAFF_ID></m104:REMOVE_STAFF_ID><m104:REMOVE_CHANGE></m104:REMOVE_CHANGE><m104:UPDATE_TIME>20170823111002</m104:UPDATE_TIME><m104:UPDATE_STAFF_ID></m104:UPDATE_STAFF_ID><m104:UPDATE_DEPART_ID></m104:UPDATE_DEPART_ID><m104:BIRTHDAY>19901015000000</m104:BIRTHDAY><m104:BIRTHDAY_LUNAR></m104:BIRTHDAY_LUNAR><m104:POST_ADDRESS>河北省唐山市丰南区黄各庄镇公庄子村4排15号</m104:POST_ADDRESS><m104:POST_CODE></m104:POST_CODE><m104:POST_PERSON></m104:POST_PERSON><m104:FAX_NBR></m104:FAX_NBR><m104:EMAIL></m104:EMAIL><m104:HOME_ADDRESS></m104:HOME_ADDRESS><m104:HOME_PHONE></m104:HOME_PHONE><m104:WORK_NAME></m104:WORK_NAME><m104:WORK_KIND>00</m104:WORK_KIND><m104:WORK_ADDRESS></m104:WORK_ADDRESS><m104:WORK_PHONE></m104:WORK_PHONE><m104:CALLING_TYPE_CODE></m104:CALLING_TYPE_CODE><m104:SUB_CALLING_TYPE_CODE></m104:SUB_CALLING_TYPE_CODE><m104:WORK_DEPART></m104:WORK_DEPART><m104:JOB></m104:JOB><m104:CONTACT>徐婷</m104:CONTACT><m104:CONTACT_PHONE>18658188772</m104:CONTACT_PHONE><m104:LOCAL_NATIVE_CODE></m104:LOCAL_NATIVE_CODE><m104:FOLK_CODE>01</m104:FOLK_CODE><m104:JOB_TYPE_CODE></m104:JOB_TYPE_CODE><m104:REVENUE_LEVEL_CODE></m104:REVENUE_LEVEL_CODE><m104:EDUCATE_DEGREE_CODE></m104:EDUCATE_DEGREE_CODE><m104:CHARACTER_TYPE_CODE></m104:CHARACTER_TYPE_CODE><m104:RSRV_TAG1>5</m104:RSRV_TAG1><m104:USER_LIST><m104:SERIAL_NUMBER>13235712211</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617122167622434</m104:USER_ID><m104:USECUST_ID>3617081411930229</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171221110515</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171221110524</m104:IN_DATE></m104:USER_LIST><m104:USER_LIST><m104:SERIAL_NUMBER>13248439393</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617121567372160</m104:USER_ID><m104:USECUST_ID>3617081411930229</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171215164330</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171215164342</m104:IN_DATE></m104:USER_LIST><m104:USER_LIST><m104:SERIAL_NUMBER>13276814567</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617121967593458</m104:USER_ID><m104:USECUST_ID>3617081411930229</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171219115230</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171219115242</m104:IN_DATE></m104:USER_LIST><m104:USER_LIST><m104:SERIAL_NUMBER>13235713300</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617120867088498</m104:USER_ID><m104:USECUST_ID>3617081411930229</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171208171130</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171208171138</m104:IN_DATE></m104:USER_LIST><m104:USER_LIST><m104:SERIAL_NUMBER>13248402277</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617120867088491</m104:USER_ID><m104:USECUST_ID>3617081411930229</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171208165105</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171208165115</m104:IN_DATE></m104:USER_LIST><m104:PARTY_ISBWL>0</m104:PARTY_ISBWL><m104:OWE_TAG>0</m104:OWE_TAG><m104:ARREARAGE_MESS><m104:SERIAL_NUMBER>13235712211</m104:SERIAL_NUMBER><m104:ARREARAGE_FEE>0</m104:ARREARAGE_FEE></m104:ARREARAGE_MESS><m104:ACCT_INFO><m104:ACCT_ID>3617081461561310</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617081466649377</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>18658188772</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20170822161710</m104:OPEN_DATE></m104:ACCT_INFO><m104:ACCT_INFO><m104:ACCT_ID>3617121962211958</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617121967593458</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13276814567</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171219114641</m104:OPEN_DATE></m104:ACCT_INFO><m104:ACCT_INFO><m104:ACCT_ID>3617120861932494</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617120867088491</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13248402277</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171208163752</m104:OPEN_DATE></m104:ACCT_INFO><m104:ACCT_INFO><m104:ACCT_ID>3617120861932496</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617120867088498</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13235713300</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171208170651</m104:OPEN_DATE></m104:ACCT_INFO><m104:ACCT_INFO><m104:ACCT_ID>3617121562096379</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617121567372160</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13248439393</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171215163540</m104:OPEN_DATE></m104:ACCT_INFO><m104:ACCT_INFO><m104:ACCT_ID>3617122162226824</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617122167622434</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13235712211</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171221110005</m104:OPEN_DATE></m104:ACCT_INFO></m104:CUST_INFO><m104:CUST_INFO><m104:CUST_ID>3617121312351910</m104:CUST_ID><m104:CUST_NAME>徐婷</m104:CUST_NAME><m104:CUST_TYPE>0</m104:CUST_TYPE><m104:CUST_STATE>0</m104:CUST_STATE><m104:CERT_END_DATE>20991231</m104:CERT_END_DATE><m104:CERT_ADDR>河北省唐山市丰南区黄各庄镇公庄子村4排15号</m104:CERT_ADDR><m104:CERT_TYPE_CODE>1</m104:CERT_TYPE_CODE><m104:CERT_CODE>130282199010151829</m104:CERT_CODE><m104:PHONE>18658188772</m104:PHONE><m104:EPARCHY_CODE>0571</m104:EPARCHY_CODE><m104:CITY_CODE>362001</m104:CITY_CODE><m104:CUST_PASSWD></m104:CUST_PASSWD><m104:DEVELOP_DEPART_ID></m104:DEVELOP_DEPART_ID><m104:DEVELOP_STAFF_ID></m104:DEVELOP_STAFF_ID><m104:IN_DATE>20171213154745</m104:IN_DATE><m104:REMOVE_STAFF_ID></m104:REMOVE_STAFF_ID><m104:REMOVE_CHANGE></m104:REMOVE_CHANGE><m104:UPDATE_TIME>20171213155648</m104:UPDATE_TIME><m104:UPDATE_STAFF_ID></m104:UPDATE_STAFF_ID><m104:UPDATE_DEPART_ID></m104:UPDATE_DEPART_ID><m104:BIRTHDAY></m104:BIRTHDAY><m104:BIRTHDAY_LUNAR></m104:BIRTHDAY_LUNAR><m104:POST_ADDRESS>河北省唐山市丰南区黄各庄镇公庄子村4排15号</m104:POST_ADDRESS><m104:POST_CODE></m104:POST_CODE><m104:POST_PERSON></m104:POST_PERSON><m104:FAX_NBR></m104:FAX_NBR><m104:EMAIL></m104:EMAIL><m104:HOME_ADDRESS></m104:HOME_ADDRESS><m104:HOME_PHONE></m104:HOME_PHONE><m104:WORK_NAME></m104:WORK_NAME><m104:WORK_KIND>00</m104:WORK_KIND><m104:WORK_ADDRESS></m104:WORK_ADDRESS><m104:WORK_PHONE></m104:WORK_PHONE><m104:CALLING_TYPE_CODE></m104:CALLING_TYPE_CODE><m104:SUB_CALLING_TYPE_CODE></m104:SUB_CALLING_TYPE_CODE><m104:WORK_DEPART></m104:WORK_DEPART><m104:JOB></m104:JOB><m104:CONTACT>徐婷</m104:CONTACT><m104:CONTACT_PHONE>18658188772</m104:CONTACT_PHONE><m104:LOCAL_NATIVE_CODE></m104:LOCAL_NATIVE_CODE><m104:FOLK_CODE></m104:FOLK_CODE><m104:JOB_TYPE_CODE></m104:JOB_TYPE_CODE><m104:REVENUE_LEVEL_CODE></m104:REVENUE_LEVEL_CODE><m104:EDUCATE_DEGREE_CODE></m104:EDUCATE_DEGREE_CODE><m104:CHARACTER_TYPE_CODE></m104:CHARACTER_TYPE_CODE><m104:RSRV_TAG1>4</m104:RSRV_TAG1><m104:USER_LIST><m104:SERIAL_NUMBER>13248452626</m104:SERIAL_NUMBER><m104:USER_STATE>0</m104:USER_STATE><m104:USER_TYPE_CODE>0</m104:USER_TYPE_CODE><m104:SERVICE_CLASS_CODE>0050</m104:SERVICE_CLASS_CODE><m104:PREPAY_TAG>1</m104:PREPAY_TAG><m104:USER_ID>3617121367370717</m104:USER_ID><m104:USECUST_ID>3617121312351910</m104:USECUST_ID><m104:NET_TYPE_CODE>0050</m104:NET_TYPE_CODE><m104:BRAND_CODE>4G00</m104:BRAND_CODE><m104:PRODUCT_ID>90126144</m104:PRODUCT_ID><m104:OPEN_DATE>20171213155635</m104:OPEN_DATE><m104:REMOVE_TAG>0</m104:REMOVE_TAG><m104:IN_DATE>20171213155646</m104:IN_DATE></m104:USER_LIST><m104:PARTY_ISBWL>0</m104:PARTY_ISBWL><m104:OWE_TAG>0</m104:OWE_TAG><m104:ARREARAGE_MESS><m104:SERIAL_NUMBER>13248452626</m104:SERIAL_NUMBER><m104:ARREARAGE_FEE>0</m104:ARREARAGE_FEE></m104:ARREARAGE_MESS><m104:ACCT_INFO><m104:ACCT_ID>3617121362093471</m104:ACCT_ID><m104:DEBUTY_USER_ID>3617121367370717</m104:DEBUTY_USER_ID><m104:DEBUTY_CODE>13248452626</m104:DEBUTY_CODE><m104:PAY_NAME>徐婷</m104:PAY_NAME><m104:PAY_MODE_CODE>0</m104:PAY_MODE_CODE><m104:SCORE_VALUE>0</m104:SCORE_VALUE><m104:CONTRACT_NO>0</m104:CONTRACT_NO><m104:OPEN_DATE>20171213154745</m104:OPEN_DATE></m104:ACCT_INFO></m104:CUST_INFO></m104:QRY_CUST_INFO_RSP></m:UNI_BSS_BODY><a:UNI_BSS_ATTACHED xmlns:a=\"http://ws.chinaunicom.cn/unibssAttached\" /></m:QRY_CUST_INFO_OUTPUT></SOAP-ENV:Body></SOAP-ENV:Envelope>");
        exchange.setOut(out);
        xml.process(exchange);
    }

    @Override
    public void applyParams(String[] params) {
        this.xmlTemplatePath = Config.getStr(params[0]) + "_Rsp.xml";
    }
}
